<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.huawei.kdd.omCoverageEvaluation.yang.dao.YangDao">

	<!-- 获取yang覆盖数 -->
	<select id="getYangCoverage" resultType="Integer">

		<!-- 产品下 基线被匹配到的总数 -->
		<if test="start == 1">
		SELECT count(*)
			FROM (select 'x' from 
    (select b.guid from 
    (select a.*,m.product,m.source testsource from t_ens_yang_base a,t_test_yang_match m where a.pdu=m.pdu and a.version=m.version)b 
    where 1=1 
     <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				and b.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and b.version=#{yvo.version}
			</if>
			<if
				test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and b.product=#{yvo.product}
			</if>
			<if
				test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
				and b.testsource=#{yvo.testSource}
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and b.subsys=#{yvo.subsys}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and b.feature=#{yvo.feature}
			</if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and b.source=#{yvo.source}
			</if>
			<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
				and b.xpath like '%${yvo.xpath}%'
			</if>
    group by b.guid) c ,
    t_test_yang_match d where c.guid=d.yang_guid group by c.guid)
		
		</if>


		<!-- 基线总数 -->
		<if test="start == 0">
		select count(*)from
          (select b.guid from 
          (select a.*,m.product,m.source testsource from t_ens_yang_base a,t_test_yang_match m where a.pdu=m.pdu and a.version=m.version)b 
             where 1=1
            <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				and b.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and b.version=#{yvo.version}
			</if>
			<if
				test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and b.product=#{yvo.product}
			</if>
			<if
				test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
				and b.testsource=#{yvo.testSource}
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and b.subsys=#{yvo.subsys}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and b.feature=#{yvo.feature}
			</if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and b.source=#{yvo.source}
			</if>
			<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
				and b.xpath like '%${yvo.xpath}%'
			</if>
              group by b.guid)
		</if>
		
	</select>


	<!-- yang 柱形图 列表 -->
	<select id="getYangList"
		resultType="com.huawei.kdd.omCoverageEvaluation.yang.povo.YangPo">
		
		   select e.subsys,count(e.guid) yangTotal,count(e.mguid) yangCoverage from
    (select c.guid,c.subsys,max(d.guid) mguid from 
    (select b.guid,b.subsys from 
    (select a.*,m.product,m.source testsource from t_ens_yang_base a,t_test_yang_match m where a.pdu=m.pdu and a.version=m.version)b 
    where 1=1 
    <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				and b.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and b.version=#{yvo.version}
			</if>
			<if
				test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and b.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and b.testsource=#{yvo.testSource}
            </if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and b.source=#{yvo.source}
			</if>
			<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
				and b.xpath like '%${yvo.xpath}%'
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and b.subsys=#{yvo.subsys}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and b.feature=#{yvo.feature}
			</if>
    group by b.guid,b.subsys) c left join
    t_test_yang_match d on c.guid=d.yang_guid group by c.guid,c.subsys)e group by e.subsys

	</select>


	<!-- yang table 表格数据 -->
	<select id="getyangTableList"
		resultType="com.huawei.kdd.omCoverageEvaluation.yang.povo.YangPo">
		
		select *
			from (select rownum r,
			y.subsys,
			y.feature,
			y.yangTotal,
			y.yangCoverage
			from(select e.subsys,e.feature,count(e.guid) yangTotal,count(e.mguid) yangCoverage from
    (select c.guid,c.subsys,c.feature,max(d.guid) mguid from 
    (select b.guid,b.subsys,b.feature from 
    (select a.*,m.product,m.source testsource from t_ens_yang_base a,t_test_yang_match m where a.pdu=m.pdu and a.version=m.version)b 
    where 1=1 
    <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				and b.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and b.version=#{yvo.version}
			</if>
			<if
				test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and b.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and b.testsource=#{yvo.testSource}
            </if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and b.source=#{yvo.source}
			</if>
			<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
				and b.xpath like '%${yvo.xpath}%'
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and b.subsys=#{yvo.subsys}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and b.feature=#{yvo.feature}
			</if>
    group by b.guid,b.subsys,b.feature) c left join
    t_test_yang_match d on c.guid=d.yang_guid group by c.guid,c.subsys,c.feature)e group by e.subsys,e.feature) y
    
              <![CDATA[
				where rownum <= #{yvo.endRow})
				where r > #{yvo.startRow}
			  ]]>
		
	</select>


	<!-- yang table 表格总数 -->
	<select id="getYangTotal" resultType="Integer">

			select count(*)
			from (
			select e.subsys,e.feature,count(e.guid) yangTotal,count(e.mguid) yangCoverage from
    (select c.guid,c.subsys,c.feature,max(d.guid) mguid from 
    (select b.guid,b.subsys,b.feature from 
    (select a.*,m.product,m.source testsource from t_ens_yang_base a,t_test_yang_match m where a.pdu=m.pdu and a.version=m.version)b 
    where 1=1 
    <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				and b.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and b.version=#{yvo.version}
			</if>
			<if
				test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and b.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and b.testsource=#{yvo.testSource}
            </if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and b.source=#{yvo.source}
			</if>
			<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
				and b.xpath like '%${yvo.xpath}%'
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and b.subsys=#{yvo.subsys}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and b.feature=#{yvo.feature}
			</if>
                group by b.guid,b.subsys,b.feature) c left join
             t_test_yang_match d on c.guid=d.yang_guid group by c.guid,c.subsys,c.feature)e group by e.subsys,e.feature)y

	</select>



	<!-- yang xpath 列表 -->
	<select id="getyangXpathList"
		resultType="com.huawei.kdd.omCoverageEvaluation.yang.povo.YangPo">

		select *
		from (select rownum r,
		y.xpath,
		y.subsys,
		y.feature,
		y.yangCover2
		from(select max(t.subsys) subsys,max(t.feature)
		feature,t.xpath,sum(t.mguid) yangCover2 from
		(select a.guid,a.subsys,a.feature,a.xpath,count(c.guid) mguid from
		t_ens_yang_base a LEFT JOIN t_test_yang_match c on(a.guid=c.yang_guid
		<if test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and c.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and c.testsource=#{yvo.testSource}
            </if>
		)
		where 1=1 
		<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and a.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and a.version=#{yvo.version}
		</if>
		<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
			and a.source=#{yvo.source}
		</if>
		<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
			and a.xpath like '%${yvo.xpath}%'
		</if>
		<if
			test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
			and a.feature=#{yvo.feature}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and a.subsys=#{yvo.subsys}
		</if>
		GROUP BY a.guid,a.subsys,a.feature,a.xpath) t GROUP BY t.xpath order
		by
		yangCover2 desc)y
		<![CDATA[
				where rownum <= #{yvo.endRow})
				where r > #{yvo.startRow}
			]]>
	</select>
	
	
	<!-- yang table 表格总数 -->
	<select id="getyangXpathTotal" resultType="Integer">
			select count(*)from(
			select max(t.subsys) subsys,max(t.feature) feature,t.xpath,sum(t.mguid)
			yangcover from
			(select a.guid,a.subsys,a.feature,a.xpath,count(c.guid) mguid from
			t_ens_yang_base a LEFT JOIN t_test_yang_match c
			on(a.guid=c.yang_guid)
			where
			<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
				a.pdu=#{yvo.pdu}
			</if>
			<if
				test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
				and a.version=#{yvo.version}
			</if>
			<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
				and a.source=#{yvo.source}
			</if>
			<if
				test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
				and a.feature=#{yvo.feature}
			</if>
			<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
				and a.subsys=#{yvo.subsys}
			</if>
			GROUP BY a.guid,a.subsys,a.feature,a.xpath) t GROUP BY t.xpath)y
	</select>


	<!--获得yang下匹配数据详细数据列表 -->
	<select id="getyangDetail"
		resultType="com.huawei.kdd.omCoverageEvaluation.yang.povo.YangPo">

		select *
		from (select rownum r,
		y.matchXpath,
		y.value,
		y.operation,
		y.type
		from(select c.xpath matchXpath,c.value,c.operation,c.type from
		(select * from t_ens_yang_base a where 1=1
		<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and a.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and a.version=#{yvo.version}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and a.subsys=#{yvo.subsys}
		</if>
		<if
			test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
			and a.feature=#{yvo.feature}
		</if>
		<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
			and a.xpath=#{yvo.xpath}
		</if>
		)b left join t_test_yang_match c on (b.guid=c.yang_guid)
		GROUP BY c.guid,c.xpath,c.value,c.operation,c.type) y
			<![CDATA[
				where rownum <= #{yvo.endRow})
				where r > #{yvo.startRow}
			]]>
	</select>



	<!-- yang detail 表格总数 -->
	<select id="getyangDetailTotal" resultType="Integer">

		select count(*) from (select c.xpath
		matchXpath,c.value,c.operation,c.type from
		(select * from t_ens_yang_base a where 1=1
		<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and a.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and a.version=#{yvo.version}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and a.subsys=#{yvo.subsys}
		</if>
		<if
			test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
			and a.feature=#{yvo.feature}
		</if>
		<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
			and a.xpath=#{yvo.xpath}
		</if>
		)b left join t_test_yang_match c on (b.guid=c.yang_guid)
		GROUP BY c.guid,c.xpath,c.value,c.operation,c.type) y

	</select>


	<select id="getversionList" resultType="com.huawei.kdd.info.povo.InfoPo">
		select
		distinct(version) as name
		from
		t_ens_yang_base b
		where
		1=1
		<if test="pdu != null and pdu != 'NULL' and pdu != '' and pdu != 'ALL'">
			and b.pdu = #{pdu}
		</if>
		order by
		version desc
	</select>


	<select id="getsourceList" resultType="com.huawei.kdd.info.povo.InfoPo">
		select
		distinct(source) as name
		from
		t_ens_yang_base b
		where 1=1
		order by source desc
	</select>
	
	
	<select id="getTestSourceList" resultType="com.huawei.kdd.info.povo.InfoPo">
		select
		distinct(source) as name
		from
		t_test_yang_match b
		where 1=1
		order by source desc
	</select>


	<select id="getproductList" resultType="com.huawei.kdd.info.povo.InfoPo">
	select distinct(a.product) as name from
    (select m.product from t_test_yang_match m where 1=1
        <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and m.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and m.version=#{yvo.version}
		</if>
        )a group by a.product order by a.product desc
	</select>


	<select id="getsubsysList" resultType="com.huawei.kdd.info.povo.InfoPo">
		select
		distinct(subsys) as name
		from
		t_ens_yang_base b
		where
		1=1
		<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and b.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and b.version=#{yvo.version}
		</if>
		<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
			and b.source=#{yvo.source}
		</if>
		order by
		subsys desc
	</select>


	<select id="getfeatureList" resultType="com.huawei.kdd.info.povo.InfoPo">
		select
		distinct(feature) as name
		from
		t_ens_yang_base b
		where
		1=1
		<if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and b.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and b.version=#{yvo.version}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and b.subsys=#{yvo.subsys}
		</if>
		<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
			and b.source=#{yvo.source}
		</if>
		order by
		feature desc
	</select>
	
	
	
	<!-- 导出yang覆盖信息 -->
	<select id="getyangExportList" resultType="com.huawei.kdd.omCoverageEvaluation.yang.povo.YangPo">
	select *
		from (select rownum r,
		y.pdu,
		y.version,
		y.xpath,
		y.subsys,
		y.feature,
		y.yangCover2
		from(select c.pdu,c.version,c.subsys,c.feature,c.xpath,count(d.guid) yangCover2 from
          (select * from t_ens_yang_base b where 1=1
          <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and b.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and b.version=#{yvo.version}
		</if>
		<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
			and b.source=#{yvo.source}
		</if>
		<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
			and b.xpath like '%${yvo.xpath}%'
		</if>
		<if
			test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
			and b.feature=#{yvo.feature}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and b.subsys=#{yvo.subsys}
		</if>
              ) c 
          left join t_test_yang_match d on c.guid=d.yang_guid
            <if test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and d.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and d.source=#{yvo.testSource}
            </if>
          group by c.guid,c.pdu,c.version,c.subsys,c.feature,c.xpath) y
	        <![CDATA[
				where rownum <= #{yvo.endRow})
				where r > #{yvo.startRow}
			]]>
	
	</select>
	
	
	<select id="getyangExportListTotal" resultType="Integer">
		select count(*) from (select c.pdu,c.version,c.subsys,c.feature,c.xpath,count(d.guid) yangCover2 from
          (select * from t_ens_yang_base b where 1=1
          <if test="yvo.pdu != null and yvo.pdu != '' and yvo.pdu != 'ALL'">
			and b.pdu=#{yvo.pdu}
		</if>
		<if
			test="yvo.version != null and yvo.version != '' and yvo.version != 'ALL'">
			and b.version=#{yvo.version}
		</if>
		<if test="yvo.source != null and yvo.source != '' and yvo.source != 'ALL'">
			and b.source=#{yvo.source}
		</if>
		<if test="yvo.xpath != null and yvo.xpath != '' and yvo.xpath != 'ALL'">
			and b.xpath like '%${yvo.xpath}%'
		</if>
		<if
			test="yvo.feature != null and yvo.feature != '' and yvo.feature != 'ALL'">
			and b.feature=#{yvo.feature}
		</if>
		<if test="yvo.subsys != null and yvo.subsys != '' and yvo.subsys != 'ALL'">
			and b.subsys=#{yvo.subsys}
		</if>
              ) c 
          left join t_test_yang_match d on c.guid=d.yang_guid
            <if test="yvo.product != null and yvo.product != '' and yvo.product != 'ALL'">
				and d.product=#{yvo.product}
			</if>
			<if test="yvo.testSource != null and yvo.testSource != '' and yvo.testSource != 'ALL'">
                and d.source=#{yvo.testSource}
            </if>
          group by c.guid,c.pdu,c.version,c.subsys,c.feature,c.xpath) y
	</select>

</mapper>
